# .github/workflows/register_flow.yml (ä¼˜åŒ–ç‰ˆæœ¬)
name: MediaFire æ‰¹é‡æ³¨å†Œæµ

on:
  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼Œå¹¶æä¾›ä¸€ä¸ªè¾“å…¥å­—æ®µæ¥æ§åˆ¶æ¬¡æ•°
  workflow_dispatch:
    inputs:
      # ç”¨æˆ·å¯ä»¥åœ¨è§¦å‘æ—¶è¾“å…¥æ¬¡æ•°ï¼Œè¿™ä¸ªå€¼ä¼šè¦†ç›–é»˜è®¤å€¼
      count_input:
        description: 'é‡å¤æ³¨å†Œçš„æ¬¡æ•°ï¼ˆå°†ä½œä¸º REGISTRATION_COUNT çš„å€¼ï¼‰'
        required: false
        default: '5'  # é»˜è®¤å€¼è®¾ç½®ä¸º 5 æ¬¡

jobs:
  batch_registration:
    runs-on: ubuntu-latest
    
    # å°† REGISTRATION_COUNT è®¾ç½®ä¸º Job çº§åˆ«çš„ç¯å¢ƒå˜é‡
    env:
      # ä¼˜å…ˆçº§ï¼šå¦‚æœç”¨æˆ·æ‰‹åŠ¨è¾“å…¥äº† count_inputï¼Œåˆ™ä½¿ç”¨è¾“å…¥å€¼ï¼›å¦åˆ™ä½¿ç”¨ '5'
      REGISTRATION_COUNT: ${{ github.event.inputs.count_input || '5' }}

    steps:
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: âš™ï¸ å®‰è£…ä¾èµ–
        run: pip install -r requirements.txt

      - name: ğŸš€ æ‰§è¡Œæ³¨å†Œè„šæœ¬
        # Env å—ä¸­å®šä¹‰äº†æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬ REGISTRATION_COUNT
        env:
          # ----------------- å¯å…¬å¼€é…ç½®çš„ URL -----------------
          MAIL_LOGIN_URL: 'https://mail.928090.xyz/'
          MEDIAFIRE_REGISTER_URL: 'https://www.mediafire.com/?nnfhfnh'
          
          # REGISTRATION_COUNT å·²ç»é€šè¿‡ Job çº§åˆ«çš„ env è®¾ç½®ï¼ŒPython è„šæœ¬å¯ä»¥ç›´æ¥é€šè¿‡ os.getenv('REGISTRATION_COUNT') è¯»å–

          # ----------------- æ•æ„Ÿä¿¡æ¯ (æ¥è‡ª Secrets) -----------------
          MAIL_USERNAME: ${{ secrets.MAIL_USERNAME }}
          MAIL_PASSWORD: ${{ secrets.MAIL_PASSWORD }}
          ACCOUNT_PASSWORD: ${{ secrets.ACCOUNT_PASSWORD }}

        run: python main.py
